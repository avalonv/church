#include "Player.h"
#include <vector>
#include <unistd.h>
#include <string>
#include <iostream>
#include <stdio.h>
#include <ncurses.h>

using namespace std;

void tty_break()
{
    initscr(); // start screen
    cbreak();  // don't buffer
    keypad(stdscr, TRUE); // enable arrow & f keys
    curs_set(0); // make cursor invisbile

}

void draw_area(vector <vector<char>> &input)
{
    for (auto vec: input)
    {
        for (auto l: vec)
        {
            printw("%c",l); // << flush;
        }
        printw("\n");
    }
    refresh();
}

int main()
{
    vector<vector<char>> current_area;
    vector<vector<vector<char>>> area_vec
    {       // X vertical, Y horizontal
        {   // church grass
            {'@',' ','.','^',',',' ','.',';','.',',','.','.',',',' ',' ',' ','^',' ',' ',' ','^','.','.','.','^',' ','^','^','.','^',',',' ',' ','^',' ',' ',' ','^',' ','.',',',' ',' ','.',';','.',',',',',' ','^','.','.','^','.',',',' ',' ','.','^','.','|','/',' ','.',';','.',',','.',',',' ',' ','.'},
            {'.',';','.',',','.','^','.','.','^','.',';','.',',','.','\\','/','^','.','\\','/','.','.','^',' ','.','.','.','^','.','.','^',',',' ','/','^','\\','^','.','.','^','.','.',',',' ','^','.','.','^','.',';','.',',','\\','|','/','.','\\','/','.','.','|','_','_','-','-','-','_','.',',',' ',' ','.'},
            {'.',';','.',',','.',';','.',',','.','^','.','^','.','\\','|','|','.','.','.','|','.','.','.','^','.',';','.',',','.','^','.','.','|','[','o',']','|','.',',',' ','.','.','^','.','.','.','^','.','.','.','\\','|','.','|','.','.','^','|','.','/',',',',',',',',',',','^',',','\\','.','^',' ','.'},
            {'^',' ',' ','^','.',';','.',',','.',';','.',',','^',' ','|','^','.','|','/','.','.','^','.',';','.',',','.','.','^','.','.','/',']','[','-',']','[','\\','.',';','.',',','.',';','.',',','.',',','.',',',' ','|','.','.','\\','|','.','^','/','.',',','.',',','.',',','.',',','^','\\','.','.','.'},
            {'.',';','.',',','.',';','.',',',',',' ',' ',' ','^',' ','.','^',' ','|','.',';','.',',','.',',',' ','^',',',' ','.','^','|','|','u','-','_','-','u','|','|','^','.','.',',',' ','.',';','.',',','.','.','\\','/',' ','^',' ','|','^','/',',',',',',',',',',',',',',',',','^',',','/','|','.','.'},
            {'.',';','.',',','.',';','.',',',',',' ','^',' ',' ','^',' ','.','.','^','^','.',';','.',',','.','^',' ','.','^','.','.','[','_','_','|','E','|','_','_',']',',',' ','^',' ','.',';','.',',','.',';','.',',','|',' ','.','^',',',' ','|','.',',','.',',','.',',','.',',','.',',','|',' ','.','.'},
            {'.',';','.',',','.',';','.',',','.',';','.',',',',',' ','.',';','.',',','.',';','.',',','.',',',' ','^','^','.','.','^','.','.',',',' ',' ','.',';','.',',','^','^','.',';','.',',','.',';','.',',','.','.',',',' ',' ','.','^','.','\\','_',',',',',',',',',',',',',',',',','/','|','.','.','.'},
            {'.',';','.',',',',',' ',' ',' ','.',';','.',',','.',';','.',',','.',';','.',',',',',' ','.','.',',',' ','^','.',',',' ','.',',',' ',' ','.','.',',',' ','.','^','.','.','^',' ',' ','.',';','.',',','.',',','.','^',' ','.',';','.',',','|','\\','-','_','.',',','.','_','-','/','.',';','.',','},
            {'.',';','.',',','.',';','.',',',',',' ',',',' ','.',';','.',',','.',';','.',',',',',' ',' ',' ','^',' ','^','.','.','.',',',' ',' ','.','.','.','^','.',',',' ','^','.',',',' ','^','.',',',' ','.',';','.',',','.',',','.',',',' ','.','.','\\','|','-',',','-','|','|','.','.','.',',',' ','.'},
            {'.',',',' ',' ','.',';','.',',','.',';','.',',','.',';','.',',','.',';','.',',','.',';','.',',','.','^','.','.',',',' ',',',' ',' ',' ','.',';','.',',','^','^',' ','^',' ',',',' ','.',',',' ','^','.',';','.',',','^','.','.','^','.','.','.',',',' ',' ',',','.',',','.',',',' ',',',' ','.'},
            {'=','.',';','.',',','.',';','.',',','.',';','.',',','.',',','.',',',' ','.',';','.',',','.',',','.',' ','^',',',' ',',',' ',' ',' ',' ',' ','.',',',' ','^',' ','^',' ','.','.','.','^','.',',',' ',' ',' ',' ',' ',' ',' ',' ','.',',',' ',' ',' ',' ',',',' ',',',' ',' ',' ',' ',' ','=','.'},
            {'E',' ',' ',' ',' ',' ',' ','.','.','.',',',' ','.',';','.',',','.',';','.',',','.',';','.',',','.','.',',',' ',' ',',',' ',' ',' ',',',' ',' ',' ',' ',',',' ','.',';','.',',','.',',',' ',' ',' ',' ',' ',' ','.','.',',',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','E','.'},
            {'=',' ',' ','.','.',',',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','.',';','.',',','.',';','.',',',',',' ',' ',',',' ',' ',' ',' ',' ',' ',' ',' ',',',' ',' ',',',' ',' ',' ',' ',' ',' ',' ',' ',' ','.',';','.',',','.',';','.',',','.',';','.',',','.',',','.',',',' ','.','.','.',' ','=','.'},
            {'.','^','.',',','.',' ','.',',',' ','.','.','.',',',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',',',' ',' ',' ',',',' ',' ',' ',' ',' ',',',' ',' ',' ',' ','.',';','.',',','.','.','^','.',';','.',',','.',';','.',',','.','.',',',' ','.',';','.',',','.',',','.',',',' ','.','.'},
            {'^','.',';','.',',','.',' ','.',';','.',',','.',';','.',',','.',';','.',',','.',',','.',',',' ','.',',','.','.',' ',',',' ',' ',' ',' ',' ','.',',',' ','.',';','.',',','.',';','.',',','.','.','^','.',';','.',',','.',';','.',',','.',';','.',',','.',';','.',',','.',',',' ','.',';','.',','},
            {',','^','.',';','.',',','.',';','.',',','.',',',' ','^','.',';','.',',','.',';','.',',','.',';','.',',','.',',','.',',',' ',',',' ',' ',',',' ','.',';','.',',','.',';','.',',','.',';','.',',','.',';','.',',',',',' ',' ','\\','|',' ','.',';','.',',','.',';','.',',','.',',','.',',',' ','.'},
            {'.',';','.',',','.',';','.',',','.',';','.',',','^',' ','^',' ','.',';','.',',','.',';','.',',','.',';','.',',','.',',','.','=','E','=','.',';','.',',','.',';','.',',','.',';','.',',','.',';','.',',','.',';','.',',','.','.','|','.',';','.',',','.',';','.',',','.',';','.',',','.',',','.'},
            {'.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.',' ','.','$'}
        }
    };
    string clear_console(1314, '\b');
    Player mc;
    mc.set_position(13,32);
//    vector<unsigned int> vec;
//    vec = mc.get_position();
    tty_break();

    while (true)
    {
        current_area = area_vec.at(0);
        current_area.at(mc.x_pos).at(mc.y_pos) = 'X';
        draw_area(current_area);

//        Player::Direction heading;
        int c = getch();
        switch(c)
        {
            case KEY_UP:
                mc.heading = Player::up;
                break;
            case KEY_DOWN:
                mc.heading = Player::down;
                break;
            case KEY_LEFT:
                mc.heading = Player::left;
                break;
            case KEY_RIGHT:
                mc.heading = Player::right;
                break;
            default:
                mc.heading = Player::left;
                break;
        }
//        tty_getchar();
        mc.move();
        usleep(100000);
//        wrefresh(stdscr);
        move(0,0);
        refresh();
    }

    endwin();
    return 0;
}
